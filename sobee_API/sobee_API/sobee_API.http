# For VS "HTTP file" / Rest Client
@baseUrl = https://localhost:7058

### ============================================================
### 0) Sanity check: correlation id + security headers exist
### EXPECT:
### - Response header includes X-Correlation-Id
### - Response headers include X-Content-Type-Options, X-Frame-Options, Referrer-Policy, Permissions-Policy
GET {{baseUrl}}/api/home/ping
Accept: application/json

### ============================================================
### J7 Observability
### Notes:
### - Run locally: dotnet run --project sobee_API/sobee_API
### - Logs: structured JSON output is written to the console.
### - Expect X-Correlation-Id response header on requests.
GET {{baseUrl}}/health/live
Accept: application/json

###
GET {{baseUrl}}/health/ready
Accept: application/json

###
GET {{baseUrl}}/metrics
Accept: text/plain

### Normal API call to observe correlation id + request logging
GET {{baseUrl}}/api/home/ping
Accept: application/json

### ============================================================
### 1) AuthPolicy rate limit test (10/min per IP for anonymous)
### Run this request ~11 times quickly (send repeatedly).
### EXPECT:
### - First ~10: 200/400 depending on credentials
### - Then: 429 with {"error":"Too many requests.","code":"RATE_LIMITED"}
POST {{baseUrl}}/login
Content-Type: application/json
Accept: application/json

{
  "email": "admin2@local.com",
  "password": "Admin123!"
}

### ============================================================
### 2) GlobalPolicy rate limit test (120/min per IP)
### This is harder to hit manually. If you want to validate quickly,
### repeatedly send this request many times in a short window.
GET {{baseUrl}}/api/products
Accept: application/json

### ============================================================
### 3) WritePolicy rate limit test (30/min per IP for guest)
### Prereq: you need a guest session id/secret from your cart endpoint.
### Step 3.1: get cart to receive X-Session-Id and X-Session-Secret headers.
GET {{baseUrl}}/api/cart
Accept: application/json

### Step 3.2: paste these after running 3.1
@sessionId = 1852bb8b-28de-4397-8f53-d216ffaae84a
@sessionSecret = 9pFY2kdF5P9HQHGd8C7xYXtxMYlMrlz4aUExXtTVuFU=

### Step 3.3: run this POST ~31 times quickly
### EXPECT:
### - First ~30: 200/409 depending on stock
### - Then: 429 RATE_LIMITED
POST {{baseUrl}}/api/cart/items
Content-Type: application/json
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}

{
  "productId": 3007,
  "quantity": 1
}

### ============================================================
### 4) Verify rate limit partitioning by user (authenticated traffic gets its own bucket)
### If you have a user token, set it here and spam as authenticated.
@userToken = CfDJ8FE_QEmxr_5Gl8E9uQQwwd1ok9YBsZ48T91xjJjuWk3YAGQgXpaud-LqjCdgljKbaM5rMArozyhoIKSwy_66ygcmBuMqmULHGAgW6MOig6Yklr1BGFEKwGmHT7oTBANu6SN2RdbeT4Gs_95xYA8MLK3Cr6lesdN1HrEy2KBxwUJY6syGvyWMDrkJsarKxocYedD75s1Mog2DD3u_NZ0OrMfdyjjV2FJqJSSMQ6iLORppGMAmeihMikI1hLMDTwI7aEzc2nXtubmIDWPY4iGrk_bQySiUcrSkC4qck5vu_2Zo2lDPc4fRRbrlifWKXg2ho6XvT3it_D3iyWQNaC-ylCOfmuNx1xOZlTq6hjE3nzJlFYPqIukDZ_GH6b31i0gm30jEJKzM5SqVvkZB5EadMrP7mrJFhRGTg7C6XCy_MFdx_DBucMLdFa0zLjWjQz1sG9D2w4EUgEyJNxcLpbUOz9OXRH-R9nnI3pq_JGAQKeyLGxm47afNJ6MC0pHkxrmCs1-gPblJZ2WYRkjiZBylMqHR-tBnOd_j8rXqBxx3_-P2B273C-I2pqll9X-vH5Dt34lOaQ0GiEN9FLH9RgGdOodRz3jIcWx0YwxuHgIcWjTNDaMB1wtLU11EtJLXdWf3qxCAInUnbUvQdWX05R3VednKK9933u853YgdXSpI5yCipXXHpGNuugVwYOrSC3_McVJNYCJ7gsbQGsA58bp2QfC5hZB3PwwCw_FsYiJi21TmZW6ExCnd1o4cCC3TPB_22ykAzZNvu0e2M2F_eqQXwEeGhh8k_uQoTf9Pi6g-P-fl

POST {{baseUrl}}/api/cart/items
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{userToken}}

{
  "productId": 1003,
  "quantity": 1
}
