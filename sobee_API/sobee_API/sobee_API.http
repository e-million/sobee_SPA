@baseUrl = https://localhost:7058

### ============================================================
### GUEST END-TO-END FLOW (Cart -> Promo -> Totals -> Checkout)
### - IMPORTANT: Step 2 issues guest headers (X-Session-Id / X-Session-Secret)
### - Copy them into @sessionId / @sessionSecret before running the rest
### ============================================================


### ------------------------------------------------------------
### 0) Get products (pick a productId with known stock/price)
### ------------------------------------------------------------
GET {{baseUrl}}/api/products
Accept: application/json


### ------------------------------------------------------------
### 1) (Optional) Clear any existing guest cart (requires session vars)
### - Skip this if you don't have session vars yet
### ------------------------------------------------------------
# DELETE {{baseUrl}}/api/cart
# Accept: application/json
# X-Session-Id: {{sessionId}}
# X-Session-Secret: {{sessionSecret}}


### ------------------------------------------------------------
### 2) Add item to cart as GUEST (ISSUES guest session headers)
### - Copy response headers into @sessionId / @sessionSecret below
### ------------------------------------------------------------
POST {{baseUrl}}/api/cart/items
Content-Type: application/json
Accept: application/json

{
  "productId": 1004,
  "quantity": 1
}


### ------------------------------------------------------------
### 3) Set guest session vars (PASTE from response headers of step 2)
### ------------------------------------------------------------
@sessionId = 0845441a-6f8d-43b1-8d3f-7cb9f24a0631
@sessionSecret = z8gNN48G83nhthtd2gETRPfM0Eu44aE5H2ZvZO05lbA=


### ------------------------------------------------------------
### 4) Get cart as GUEST (should persist + show totals)
### ------------------------------------------------------------
GET {{baseUrl}}/api/cart
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}


### ------------------------------------------------------------
### 5) Add same item again (tests "increment existing item" stock logic)
### ------------------------------------------------------------
POST {{baseUrl}}/api/cart/items
Content-Type: application/json
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}

{
  "productId": 1004,
  "quantity": 1
}


### ------------------------------------------------------------
### 6) Get cart (grab cartItemId for product 1003)
### ------------------------------------------------------------
GET {{baseUrl}}/api/cart
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}


### ------------------------------------------------------------
### 7) Update quantity (set cartItemId from step 6 response)
### - Replace 4 with your actual cartItemId
### ------------------------------------------------------------
PUT {{baseUrl}}/api/cart/items/1005
Content-Type: application/json
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}

{
  "quantity": 2
}


### ------------------------------------------------------------
### 8) Stock enforcement (expect 409 Conflict)
### - Set an intentionally huge quantity
### - Replace 4 with your cartItemId again
### ------------------------------------------------------------
PUT {{baseUrl}}/api/cart/items/1006
Content-Type: application/json
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}

{
  "quantity": 999999
}


### ------------------------------------------------------------
### 9) Apply promo (promo must exist + not expired)
### ------------------------------------------------------------
POST {{baseUrl}}/api/cart/promo/apply
Content-Type: application/json
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}

{
  "promoCode": "SUMMER10"
}


### ------------------------------------------------------------
### 10) Get cart (should show promo + subtotal/discount/total)
### ------------------------------------------------------------
GET {{baseUrl}}/api/cart
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}


### ------------------------------------------------------------
### 11) Checkout as GUEST (now requires VALID session id + secret)
### - Should create order, decrement stock, clear cart
### - Adjust request body fields if your CheckoutRequest differs
### ------------------------------------------------------------
POST {{baseUrl}}/api/orders/checkout
Content-Type: application/json
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}

{
  "shippingAddress": "123 Test St, Test City, OH",
  "paymentMethodId": 1
}


### ------------------------------------------------------------
### 12) Get cart after checkout (should be empty + totals 0)
### ------------------------------------------------------------
GET {{baseUrl}}/api/cart
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}


### ------------------------------------------------------------
### 13) Guest orders list (should show the created order)
### - If your route differs, update it accordingly
### ------------------------------------------------------------
GET {{baseUrl}}/api/orders/my
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}


### ------------------------------------------------------------
### 14) Guest order detail (set orderId from step 11 or step 13)
### ------------------------------------------------------------
GET {{baseUrl}}/api/orders/1007
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}


### ------------------------------------------------------------
### 15) Guest security tests (new hardened behavior)
### ------------------------------------------------------------

### 15.1 Missing secret should FAIL (expect 400 BadRequest)
GET {{baseUrl}}/api/orders/1004
Accept: application/json
X-Session-Id: {{sessionId}}

### 15.2 Invalid secret should FAIL (expect 400 BadRequest)
GET {{baseUrl}}/api/orders/1004
Accept: application/json
X-Session-Id: {{sessionId}}
X-Session-Secret: INVALID_SECRET


### ------------------------------------------------------------
### 16) (Optional) Remove promo (should be 400 after checkout if no promo exists)
### ------------------------------------------------------------
DELETE {{baseUrl}}/api/cart/promo
Accept: application/json


### ============================================================
### AUTH + USER PROFILE SMOKE CHECKS
### ============================================================

### ------------------------------------------------------------
### A1) Register a new user (no token issuance)
### ------------------------------------------------------------
POST {{baseUrl}}/api/auth/register
Content-Type: application/json
Accept: application/json

{
  "email": "test.user@example.com",
  "password": "P@ssw0rd123!",
  "firstName": "Test",
  "lastName": "User",
  "billingAddress": "123 Billing St",
  "shippingAddress": "456 Shipping Ave"
}

### ------------------------------------------------------------
### A2) Set auth tokens (paste from your auth system)
### ------------------------------------------------------------
@authToken = REPLACE_WITH_AUTH_TOKEN
@adminToken = REPLACE_WITH_ADMIN_TOKEN

### ------------------------------------------------------------
### A3) Get current user profile
### ------------------------------------------------------------
GET {{baseUrl}}/api/me
Accept: application/json
Authorization: Bearer {{authToken}}

### ------------------------------------------------------------
### A4) Auth test (authenticated)
### ------------------------------------------------------------
GET {{baseUrl}}/api/authtest/me
Accept: application/json
Authorization: Bearer {{authToken}}

### ------------------------------------------------------------
### A5) Auth test (admin-only)
### ------------------------------------------------------------
GET {{baseUrl}}/api/authtest/admin-only
Accept: application/json
Authorization: Bearer {{adminToken}}


### ============================================================
### ADMIN METRICS SMOKE CHECKS
### ============================================================

### ------------------------------------------------------------
### B1) Admin ping
### ------------------------------------------------------------
GET {{baseUrl}}/api/admin/ping
Accept: application/json
Authorization: Bearer {{adminToken}}

### ------------------------------------------------------------
### B2) Admin summary
### ------------------------------------------------------------
GET {{baseUrl}}/api/admin/summary
Accept: application/json
Authorization: Bearer {{adminToken}}

### ------------------------------------------------------------
### B3) Orders per day
### ------------------------------------------------------------
GET {{baseUrl}}/api/admin/orders-per-day?days=30
Accept: application/json
Authorization: Bearer {{adminToken}}

### ------------------------------------------------------------
### B4) Low stock
### ------------------------------------------------------------
GET {{baseUrl}}/api/admin/low-stock?threshold=5
Accept: application/json
Authorization: Bearer {{adminToken}}

### ------------------------------------------------------------
### B5) Top products
### ------------------------------------------------------------
GET {{baseUrl}}/api/admin/top-products?limit=5
Accept: application/json
Authorization: Bearer {{adminToken}}


### ============================================================
### PRODUCT + REVIEWS SMOKE CHECKS
### ============================================================

### ------------------------------------------------------------
### C1) Admin create product
### ------------------------------------------------------------
POST {{baseUrl}}/api/products
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{adminToken}}

{
  "name": "Test Product",
  "description": "Test product description",
  "price": 9.99,
  "stockAmount": 10
}

### ------------------------------------------------------------
### C2) Admin update product (replace {id})
### ------------------------------------------------------------
PUT {{baseUrl}}/api/products/1000
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{adminToken}}

{
  "name": "Test Product Updated",
  "price": 12.99
}

### ------------------------------------------------------------
### C3) Admin add product image (replace {id})
### ------------------------------------------------------------
POST {{baseUrl}}/api/products/1000/images
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{adminToken}}

{
  "url": "https://example.com/test-image.jpg"
}

### ------------------------------------------------------------
### C4) Admin delete product image (replace {productId}/{imageId})
### ------------------------------------------------------------
DELETE {{baseUrl}}/api/products/1000/images/2000
Accept: application/json
Authorization: Bearer {{adminToken}}

### ------------------------------------------------------------
### C5) Admin delete product (replace {id})
### ------------------------------------------------------------
DELETE {{baseUrl}}/api/products/1000
Accept: application/json
Authorization: Bearer {{adminToken}}

### ------------------------------------------------------------
### D1) Get reviews for a product (replace {productId})
### ------------------------------------------------------------
GET {{baseUrl}}/api/reviews/product/1000
Accept: application/json

### ------------------------------------------------------------
### D2) Create review for a product (auth or valid guest session)
### ------------------------------------------------------------
POST {{baseUrl}}/api/reviews/product/1000
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{authToken}}

{
  "reviewText": "Great product!",
  "rating": 5
}

### ------------------------------------------------------------
### D3) Reply to a review (replace {reviewId})
### ------------------------------------------------------------
POST {{baseUrl}}/api/reviews/1000/reply
Content-Type: application/json
Accept: application/json
Authorization: Bearer {{authToken}}

{
  "content": "Thanks for the feedback!"
}

### ------------------------------------------------------------
### D4) Delete a review (replace {reviewId})
### ------------------------------------------------------------
DELETE {{baseUrl}}/api/reviews/1000
Accept: application/json
Authorization: Bearer {{authToken}}

### ------------------------------------------------------------
### D5) Delete a reply (replace {replyId})
### ------------------------------------------------------------
DELETE {{baseUrl}}/api/reviews/replies/1000
Accept: application/json
Authorization: Bearer {{authToken}}
X-Session-Id: {{sessionId}}
X-Session-Secret: {{sessionSecret}}
