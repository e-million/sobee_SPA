<div class="space-y-8">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <p class="text-sm uppercase tracking-[0.2em] text-slate-500">Overview</p>
      <h1 class="text-3xl font-display font-bold text-slate-800">Admin Dashboard</h1>
    </div>
    <button type="button" class="btn-outline text-sm px-4 py-2" (click)="loadDashboard()">
      Refresh data
    </button>
  </div>

  @if (error()) {
    <div class="p-4 bg-red-50 border border-red-200 rounded-lg text-red-700">
      {{ error() }}
    </div>
  }

  @if (loading()) {
    <div class="grid md:grid-cols-2 xl:grid-cols-5 gap-4">
      @for (i of [1, 2, 3, 4]; track i) {
        <div class="card p-6 animate-pulse">
          <div class="h-4 bg-slate-200 rounded w-1/2 mb-4"></div>
          <div class="h-8 bg-slate-200 rounded w-1/3"></div>
        </div>
      }
    </div>
  } @else if (summary(); as data) {
    <div class="grid md:grid-cols-2 xl:grid-cols-4 gap-4">
      <div class="card p-6">
        <p class="text-sm text-slate-500">Total Orders</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">{{ data.totalOrders }}</p>
      </div>
      <div class="card p-6">
        <p class="text-sm text-slate-500">Total Revenue</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">
          {{ data.totalRevenue | currency:'USD':'symbol':'1.2-2' }}
        </p>
      </div>
      <div class="card p-6">
        <p class="text-sm text-slate-500">Total Discounts</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">
          {{ data.totalDiscounts | currency:'USD':'symbol':'1.2-2' }}
        </p>
      </div>
      <div class="card p-6">
        <p class="text-sm text-slate-500">Avg Order Value</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">
          {{ data.averageOrderValue | currency:'USD':'symbol':'1.2-2' }}
        </p>
      </div>
    </div>
  }

  @if (!loading()) {
    <div class="grid md:grid-cols-2 xl:grid-cols-4 gap-4">
      <div class="card p-6">
        <p class="text-sm text-slate-500">Out of Stock</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">{{ inventorySummary()?.outOfStockCount ?? 0 }}</p>
        <p class="text-xs text-slate-500 mt-2">
          {{ inventorySummary()?.lowStockCount ?? 0 }} low-stock items
        </p>
      </div>
      <div class="card p-6">
        <p class="text-sm text-slate-500">New Customers (30 days)</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">{{ customerBreakdown()?.newCustomers ?? 0 }}</p>
        <p class="text-xs text-slate-500 mt-2">
          {{ (customerBreakdown()?.newCustomerRevenue ?? 0) | currency:'USD':'symbol':'1.2-2' }} revenue
        </p>
      </div>
      <div class="card p-6">
        <p class="text-sm text-slate-500">Returning Customers (30 days)</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">{{ customerBreakdown()?.returningCustomers ?? 0 }}</p>
        <p class="text-xs text-slate-500 mt-2">
          {{ (customerBreakdown()?.returningCustomerRevenue ?? 0) | currency:'USD':'symbol':'1.2-2' }} revenue
        </p>
      </div>
      <div class="card p-6">
        <p class="text-sm text-slate-500">Avg Rating</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">
          {{ (ratingDistribution()?.averageRating ?? 0) | number:'1.1-1' }}
        </p>
        <p class="text-xs text-slate-500 mt-2">
          {{ ratingDistribution()?.totalReviews ?? 0 }} reviews
        </p>
      </div>
      <div class="card p-6">
        <p class="text-sm text-slate-500">Inventory Value</p>
        <p class="text-2xl font-semibold text-slate-800 mt-2">
          {{ (inventorySummary()?.totalStockValue ?? 0) | currency:'USD':'symbol':'1.2-2' }}
        </p>
        <p class="text-xs text-slate-500 mt-2">Cost basis</p>
      </div>
    </div>
  }

  @if (!loading()) {
    <div class="grid lg:grid-cols-2 gap-6">
      <div class="card p-6">
        <div class="flex flex-wrap items-center justify-between gap-4 mb-5">
          <div>
            <h2 class="text-lg font-semibold text-slate-800">Revenue by period</h2>
            <p class="text-sm text-slate-500">Last 30 days with {{ revenueGranularity() }} granularity</p>
          </div>
          <div class="flex items-center gap-2">
            <button
              type="button"
              class="text-xs px-3 py-1 rounded-full border border-slate-200 text-slate-600"
              [class.bg-slate-900]="revenueGranularity() === 'day'"
              [class.text-white]="revenueGranularity() === 'day'"
              [class.border-slate-900]="revenueGranularity() === 'day'"
              (click)="setRevenueGranularity('day')">
              Day
            </button>
            <button
              type="button"
              class="text-xs px-3 py-1 rounded-full border border-slate-200 text-slate-600"
              [class.bg-slate-900]="revenueGranularity() === 'week'"
              [class.text-white]="revenueGranularity() === 'week'"
              [class.border-slate-900]="revenueGranularity() === 'week'"
              (click)="setRevenueGranularity('week')">
              Week
            </button>
            <button
              type="button"
              class="text-xs px-3 py-1 rounded-full border border-slate-200 text-slate-600"
              [class.bg-slate-900]="revenueGranularity() === 'month'"
              [class.text-white]="revenueGranularity() === 'month'"
              [class.border-slate-900]="revenueGranularity() === 'month'"
              (click)="setRevenueGranularity('month')">
              Month
            </button>
          </div>
        </div>

        @if (revenueByPeriod().length === 0) {
          <p class="text-sm text-slate-500">No revenue data available.</p>
        } @else {
          <div class="space-y-3">
            @for (item of revenueByPeriod(); track item.date) {
              <div class="flex items-center gap-3">
                <span class="w-24 text-xs text-slate-500">{{ formatPeriodLabel(item.date) }}</span>
                <div class="flex-1 h-2 rounded-full bg-slate-200 overflow-hidden">
                  <div class="h-full bg-emerald-500" [style.width.%]="getRevenueBarWidth(item.revenue)"></div>
                </div>
                <div class="text-xs text-slate-600 w-24 text-right">
                  {{ item.revenue | currency:'USD':'symbol':'1.0-0' }}
                </div>
              </div>
              <p class="text-xs text-slate-400 ml-24">
                {{ item.orderCount }} orders -
                {{ item.avgOrderValue | currency:'USD':'symbol':'1.0-0' }} avg
              </p>
            }
          </div>
        }
      </div>

      <div class="card p-6">
        <div class="flex items-center justify-between mb-5">
          <div>
            <h2 class="text-lg font-semibold text-slate-800">Orders by status</h2>
            <p class="text-sm text-slate-500">Distribution of current order states</p>
          </div>
          <span class="text-xs text-slate-400">{{ orderStatus()?.total ?? 0 }} total</span>
        </div>

        @if ((orderStatus()?.total ?? 0) === 0) {
          <p class="text-sm text-slate-500">No order status data available.</p>
        } @else {
          <div class="space-y-3">
            @for (item of getOrderStatusItems(); track item.label) {
              <div class="flex items-center gap-3">
                <span class="w-24 text-xs text-slate-500">{{ item.label }}</span>
                <div class="flex-1 h-2 rounded-full bg-slate-200 overflow-hidden">
                  <div class="h-full bg-primary-500" [style.width.%]="getOrderStatusBarWidth(item.count)"></div>
                </div>
                <span class="text-xs text-slate-600 w-10 text-right">{{ item.count }}</span>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  @if (!loading()) {
    <div class="grid lg:grid-cols-2 gap-6">
      <div class="card p-6">
        <div class="flex items-center justify-between mb-5">
          <div>
            <h2 class="text-lg font-semibold text-slate-800">Rating distribution</h2>
            <p class="text-sm text-slate-500">How customers are scoring products</p>
          </div>
          <span class="text-xs text-slate-400">
            {{ (ratingDistribution()?.averageRating ?? 0) | number:'1.1-1' }} avg
          </span>
        </div>

        @if ((ratingDistribution()?.totalReviews ?? 0) === 0) {
          <p class="text-sm text-slate-500">No reviews yet.</p>
        } @else {
          <div class="space-y-3">
            @for (item of getRatingItems(); track item.label) {
              <div class="flex items-center gap-3">
                <span class="w-16 text-xs text-slate-500">{{ item.label }}</span>
                <div class="flex-1 h-2 rounded-full bg-slate-200 overflow-hidden">
                  <div class="h-full bg-amber-500" [style.width.%]="getRatingBarWidth(item.count)"></div>
                </div>
                <span class="text-xs text-slate-600 w-10 text-right">{{ item.count }}</span>
              </div>
            }
          </div>
        }
      </div>

      <div class="card p-6">
        <div class="flex items-center justify-between mb-5">
          <div>
            <h2 class="text-lg font-semibold text-slate-800">Recent reviews</h2>
            <p class="text-sm text-slate-500">Latest feedback to respond to</p>
          </div>
        </div>

        @if (recentReviews().length === 0) {
          <p class="text-sm text-slate-500">No recent reviews.</p>
        } @else {
          <div class="space-y-4">
            @for (review of recentReviews(); track review.reviewId) {
              <div class="border border-slate-100 rounded-lg p-3">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm font-semibold text-slate-800">{{ review.productName }}</p>
                    <p class="text-xs text-slate-500">Review #{{ review.reviewId }} - {{ formatDate(review.createdAt) }}</p>
                  </div>
                  <span class="text-xs font-semibold text-amber-600">{{ review.rating }}/5</span>
                </div>
                <p class="text-sm text-slate-600 mt-2">{{ truncateComment(review.comment) }}</p>
                <p class="text-xs text-slate-400 mt-2">
                  {{ formatUserId(review.userId) }}
                  @if (review.hasReplies) { - replied }
                </p>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  @if (!loading()) {
    <div class="grid lg:grid-cols-2 gap-6">
      <div class="card p-6">
        <div class="flex items-center justify-between mb-5">
          <div>
            <h2 class="text-lg font-semibold text-slate-800">Customer growth</h2>
            <p class="text-sm text-slate-500">New registrations in the last 30 days</p>
          </div>
        </div>

        @if (customerGrowth().length === 0) {
          <p class="text-sm text-slate-500">No new registrations in this period.</p>
        } @else {
          <div class="space-y-3">
            @for (item of customerGrowth(); track item.date) {
              <div class="flex items-center gap-3">
                <span class="w-16 text-xs text-slate-500">{{ formatDate(item.date) }}</span>
                <div class="flex-1 h-2 rounded-full bg-slate-200 overflow-hidden">
                  <div class="h-full bg-sky-500" [style.width.%]="getCustomerGrowthBarWidth(item.newRegistrations)"></div>
                </div>
                <span class="text-xs text-slate-600 w-10 text-right">{{ item.newRegistrations }}</span>
              </div>
              <p class="text-xs text-slate-400 ml-16">
                {{ item.cumulativeTotal }} total customers
              </p>
            }
          </div>
        }
      </div>

      <div class="card p-6">
        <div class="flex items-center justify-between mb-5">
          <div>
            <h2 class="text-lg font-semibold text-slate-800">Top customers</h2>
            <p class="text-sm text-slate-500">Highest spenders in the last 30 days</p>
          </div>
        </div>

        @if (topCustomers().length === 0) {
          <p class="text-sm text-slate-500">No customer data available.</p>
        } @else {
          <div class="space-y-3">
            @for (customer of topCustomers(); track customer.userId) {
              <div class="flex items-center justify-between gap-4">
                <div>
                  <p class="text-sm font-medium text-slate-800">{{ getTopCustomerLabel(customer) }}</p>
                  <p class="text-xs text-slate-500">
                    {{ customer.orderCount }} orders
                    @if (customer.lastOrderDate) { - last {{ formatDate(customer.lastOrderDate) }} }
                  </p>
                </div>
                <span class="text-xs font-semibold text-slate-700">
                  {{ customer.totalSpent | currency:'USD':'symbol':'1.2-2' }}
                </span>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  @if (!loading()) {
    <div class="grid lg:grid-cols-2 gap-6">
      <div class="card p-6">
        <div class="flex items-center justify-between mb-5">
          <div>
            <h2 class="text-lg font-semibold text-slate-800">Category performance</h2>
            <p class="text-sm text-slate-500">Revenue by category in the last 30 days</p>
          </div>
        </div>

        @if (categoryPerformance().length === 0) {
          <p class="text-sm text-slate-500">No category data available.</p>
        } @else {
          <div class="space-y-4">
            @for (item of categoryPerformance(); track item.categoryName) {
              <div>
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm font-medium text-slate-800">{{ item.categoryName }}</p>
                    <p class="text-xs text-slate-500">{{ item.unitsSold }} units - {{ item.productCount }} products</p>
                  </div>
                  <span class="text-xs font-semibold text-slate-700">
                    {{ item.revenue | currency:'USD':'symbol':'1.2-2' }}
                  </span>
                </div>
                <div class="mt-2 h-2 rounded-full bg-slate-200 overflow-hidden">
                  <div class="h-full bg-indigo-500" [style.width.%]="getCategoryBarWidth(item.revenue)"></div>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <div class="card p-6">
        <div class="flex items-center justify-between mb-5">
          <div>
            <h2 class="text-lg font-semibold text-slate-800">Fulfillment speed</h2>
            <p class="text-sm text-slate-500">Average time to ship and deliver</p>
          </div>
        </div>

        @if (!fulfillmentMetrics()) {
          <p class="text-sm text-slate-500">No fulfillment data yet.</p>
        } @else {
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-xs text-slate-500 uppercase tracking-wide">Avg to ship</p>
              <p class="text-2xl font-semibold text-slate-800 mt-2">
                {{ (fulfillmentMetrics()?.avgHoursToShip ?? 0) | number:'1.0-1' }} hrs
              </p>
            </div>
            <div>
              <p class="text-xs text-slate-500 uppercase tracking-wide">Avg to deliver</p>
              <p class="text-2xl font-semibold text-slate-800 mt-2">
                {{ (fulfillmentMetrics()?.avgHoursToDeliver ?? 0) | number:'1.0-1' }} hrs
              </p>
            </div>
          </div>
          <p class="text-xs text-slate-500 mt-4">
            Trend vs last period:
            <span
              class="font-semibold"
              [class.text-emerald-600]="(fulfillmentMetrics()?.trend ?? 0) < 0"
              [class.text-rose-600]="(fulfillmentMetrics()?.trend ?? 0) > 0"
              [class.text-slate-500]="(fulfillmentMetrics()?.trend ?? 0) === 0">
              {{ formatTrend(fulfillmentMetrics()?.trend) }}
            </span>
          </p>
        }
      </div>
    </div>
  }

  @if (!loading()) {
    <div class="grid lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)] gap-6">
    <div class="card p-6">
      <div class="flex items-center justify-between mb-5">
        <div>
          <h2 class="text-lg font-semibold text-slate-800">Orders in the last 14 days</h2>
          <p class="text-sm text-slate-500">Daily order volume and momentum</p>
        </div>
        <span class="text-xs text-slate-400">UTC</span>
      </div>

      @if (ordersPerDay().length === 0) {
        <p class="text-sm text-slate-500">No order data available.</p>
      } @else {
        <div class="space-y-3">
          @for (item of ordersPerDay(); track item.date) {
            <div class="flex items-center gap-3">
              <span class="w-16 text-xs text-slate-500">{{ formatDate(item.date) }}</span>
              <div class="flex-1 h-2 rounded-full bg-slate-200 overflow-hidden">
                <div class="h-full bg-primary-500" [style.width.%]="getOrderBarWidth(item.count)"></div>
              </div>
              <span class="text-xs text-slate-600 w-10 text-right">{{ item.count }}</span>
            </div>
          }
        </div>
      }
    </div>

    <div class="space-y-6">
      <div class="card p-6">
        <h2 class="text-lg font-semibold text-slate-800 mb-4">Low stock alerts</h2>
        @if (lowStock().length === 0) {
          <p class="text-sm text-slate-500">Everything is well stocked.</p>
        } @else {
          <div class="space-y-3">
            @for (item of lowStock(); track item.productId) {
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-slate-800">{{ item.name }}</p>
                  <p class="text-xs text-slate-500">Product #{{ item.productId }}</p>
                </div>
                <span class="text-xs font-semibold text-red-600">{{ item.stockAmount }} left</span>
              </div>
            }
          </div>
        }
      </div>

      <div class="card p-6">
        <h2 class="text-lg font-semibold text-slate-800 mb-4">Top products</h2>
        @if (topProducts().length === 0) {
          <p class="text-sm text-slate-500">No sales yet.</p>
        } @else {
          <div class="space-y-3">
            @for (item of topProducts(); track item.productId) {
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-slate-800">{{ item.name }}</p>
                  <p class="text-xs text-slate-500">{{ item.quantitySold }} units</p>
                </div>
                <span class="text-xs font-semibold text-slate-700">
                  {{ item.revenue | currency:'USD':'symbol':'1.2-2' }}
                </span>
              </div>
            }
          </div>
        }
      </div>

      <div class="card p-6">
        <h2 class="text-lg font-semibold text-slate-800 mb-4">Worst performers</h2>
        @if (worstProducts().length === 0) {
          <p class="text-sm text-slate-500">No data available.</p>
        } @else {
          <div class="space-y-3">
            @for (item of worstProducts(); track item.productId) {
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-slate-800">{{ item.name }}</p>
                  <p class="text-xs text-slate-500">{{ item.unitsSold }} units</p>
                </div>
                <span class="text-xs font-semibold text-slate-700">
                  {{ item.revenue | currency:'USD':'symbol':'1.2-2' }}
                </span>
              </div>
            }
          </div>
        }
      </div>

      <div class="card p-6">
        <h2 class="text-lg font-semibold text-slate-800 mb-4">Most wishlisted</h2>
        @if (mostWishlisted().length === 0) {
          <p class="text-sm text-slate-500">No wishlist data yet.</p>
        } @else {
          <div class="space-y-3">
            @for (item of mostWishlisted(); track item.productId) {
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-slate-800">{{ formatWishlistName(item.name) }}</p>
                  <p class="text-xs text-slate-500">{{ item.wishlistCount }} saves</p>
                </div>
                <span class="text-xs text-slate-600">#{{ item.productId }}</span>
              </div>
            }
          </div>
        }
      </div>
    </div>
    </div>
  }
</div>
